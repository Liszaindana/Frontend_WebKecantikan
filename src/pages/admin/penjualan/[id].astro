---
import AdminLayout from "../../../layouts/adminLayout.astro";

export async function getStaticPaths() {
    const resp = await fetch("http://localhost:3000/orders");
    const orders = await resp.json();
    return orders.map((o: any) => ({
        params: { id: o.ORDER_ID.toString() },
    }));
}

const { id } = Astro.params;

// Fetch Order Info
const respOrder = await fetch(`http://localhost:3000/orders/${id}`);
const order = await respOrder.json();

// Fetch Order Details (Products in this order)
const respDetails = await fetch(`http://localhost:3000/order-details/${id}`);
const details = await respDetails.json();
---

<AdminLayout title={`Detail Pesanan #${id}`}>
    <div class="glass-panel section">
        <div class="header">
            <a href="/admin/penjualan" class="back-link">‚Üê Kembali</a>
            <h2>Detail Pesanan #{id}</h2>
        </div>

        <div class="order-summary">
            <div class="info-card">
                <label>Pelanggan</label>
                <div class="value">{order.CUST_NAME || "Guest"}</div>
            </div>
            <div class="info-card">
                <label>Tanggal Transaksi</label>
                <div class="value">
                    {new Date(order.ORDER_DATE).toLocaleString("id-ID")}
                </div>
            </div>
            <div class="info-card">
                <label>Total Pembayaran</label>
                <div class="value highlight">
                    Rp {order.TOTAL?.toLocaleString("id-ID")}
                </div>
            </div>
        </div>

        <div class="items-table mt-8">
            <h3>Daftar Produk</h3>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Produk</th>
                            <th>Harga Satuan</th>
                            <th>Jumlah</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        {
                            details.map((item: any) => (
                                <tr>
                                    <td class="font-bold">
                                        {item.PRODUCT_NAME}
                                    </td>
                                    <td>
                                        Rp {item.PRICE?.toLocaleString("id-ID")}
                                    </td>
                                    <td>{item.QTY}</td>
                                    <td class="primary-text">
                                        Rp{" "}
                                        {item.SUBTOTAL?.toLocaleString("id-ID")}
                                    </td>
                                </tr>
                            ))
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</AdminLayout>

<style>
    .section {
        padding: 2rem;
    }
    .header {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-bottom: 2rem;
    }
    .back-link {
        color: var(--color-primary);
        font-weight: 600;
        text-decoration: none;
    }
    h2 {
        margin: 0;
    }

    .order-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        background: rgba(255, 255, 255, 0.5);
        padding: 1.5rem;
        border-radius: 1rem;
    }
    .info-card label {
        display: block;
        font-size: 0.75rem;
        text-transform: uppercase;
        color: var(--color-text-muted);
        letter-spacing: 0.05em;
        margin-bottom: 0.25rem;
    }
    .info-card .value {
        font-weight: 700;
        font-size: 1.1rem;
    }
    .highlight {
        color: var(--color-primary);
    }

    .mt-8 {
        margin-top: 2rem;
    }
    h3 {
        margin-bottom: 1rem;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
    }
    .data-table th,
    .data-table td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid var(--color-border);
    }
    .primary-text {
        color: var(--color-primary);
        font-weight: 700;
    }
</style>
